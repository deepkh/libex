### NetSync.tv Third-party library build scripts
### Grey Huang <deepkh@gmail.com>
### 2016

SHELL=/bin/sh

.PHONY: EXTERNAL BUILD_BINUCHARDET BUILD_LIBEVENT

# BUILD_XXXXX: Make sure the build order when assigned with -jN
BUILD_BINUCHARDET:
ifneq (, $(LIBUCHARDET_PHONY))
	@$(CD) ${LIBUCHARDET} && $(MAKE) -f Makefile.inc $(LIBUCHARDET_PHONY)
endif
ifneq (, $(BINUCHARDET_PHONY))
	@$(CD) ${BINUCHARDET} && $(MAKE) -f Makefile.inc $(BINUCHARDET_PHONY)
endif

BUILD_LIBEVENT: 
ifneq (, $(LIBOPENSSL_PHONY))
	@$(CD) ${LIBOPENSSL} && $(MAKE) -f Makefile.inc $(LIBOPENSSL_PHONY)
endif
ifneq (, $(LIBEVENT_PHONY))
	@$(CD) ${LIBEVENT} && $(MAKE) -f Makefile.inc $(LIBEVENT_PHONY)
endif

EXTERNAL_LDFALGS=${LIBOPENSSL_LDFLAGS} ${LIBICONV_LDFLAGS} ${LIBEVENT_LDFLAGS} ${LIBLODEPNG_LDFLAGS} ${LIBUCHARDET_LDFLAGS} ${LIBJANSSON_LDFLAGS} 

EXTERNAL: 	$(LIBSYS_PHONY) \
			$(LIBKLIB_PHONY) \
			$(LIBLODEPNG_PHONY) \
			$(LIBICONV_PHONY) \
			$(LIBJANSSON_PHONY) \
			BUILD_BINUCHARDET \
			BUILD_LIBEVENT \
			$(LIBX264_PHONY) \
			$(LIBFDKAAC_PHONY) \
			$(LIBFFMPEG_PHONY)
	@echo MAKE EXTERNAL
	@echo EXTERNAL_LDFALGS ${EXTERNAL_LDFALGS}
	
EXTERNAL_CLEAN: $(LIBSYS_PHONY_CLEAN) \
				$(LIBKLIB_PHONY_CLEAN) \
				$(LIBLODEPNG_PHONY_CLEAN) \
				$(LIBICONV_PHONY_CLEAN) \
				$(LIBJANSSON_PHONY_CLEAN) \
				$(LIBUCHARDET_PHONY_CLEAN) \
				$(BINUCHARDET_PHONY_CLEAN) \
				$(LIBEVENT_PHONY_CLEAN) \
				$(LIBOPENSSL_PHONY_CLEAN) \
				$(LIBX264_PHONY_CLEAN) \
				$(LIBFDKAAC_PHONY_CLEAN) \
				$(LIBFFMPEG_PHONY_CLEAN)
	@echo MAKE EXTERNAL_CLEAN
